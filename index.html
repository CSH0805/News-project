<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ìµœì‹  í•œêµ­ ë‰´ìŠ¤</title>
  <style>
body {
  font-family: 'Noto Sans KR', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
}

.top-bar {
  width: 100%;
  background-color: #ffffff;
  border-bottom: 1px solid #ddd;
  padding: 10px 30px;
  display: flex;
  justify-content: flex-end;
  max-width: 1600px;
  margin: 0 auto;
  box-sizing: border-box;
}

.top-bar-buttons button {
  margin-left: 10px;
  padding: 6px 12px;
  background-color: #0066cc;
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  cursor: pointer;
}

.top-bar-buttons button:hover {
  background-color: #004a99;
}

h1 {
  text-align: center;
  color: #333;
  margin-bottom: 10px;
}

.news-count {
  text-align: center;
  color: #666;
  margin-bottom: 20px;
}

.main-grid {
  display: grid;
  grid-template-columns: 65% 25% 10%;
  gap: 20px;
  max-width: 1600px;
  margin: 0 auto;
  padding: 20px;
  box-sizing: border-box;
  align-items: flex-start;
}

.news-section {
  background: #fff;
  padding: 10px;
  border-radius: 8px;
}

.board-section {
  background: #fdfdfd;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 1px 5px rgba(0, 0, 0, 0.05);
  min-height: 800px;
  max-height: 1000px;
  overflow-y: auto;
  box-sizing: border-box;
}

.ad-section {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 10px;
}

.ad-image {
  width: 100%;
  height: auto;
  border-radius: 8px;
}

.news-container {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
}

.news-card {
  background: white;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.3s ease;
  display: flex;
  flex-direction: column;
}

.news-card:hover {
  transform: translateY(-5px);
}

.news-image-wrapper {
  position: relative;
  width: 100%;
  padding-top: 56.25%;
  overflow: hidden;
}

.news-image {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.news-content {
  padding: 15px;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

.news-title {
  font-size: 16px;
  margin: 0 0 10px;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

.news-date {
  color: #666;
  font-size: 12px;
  margin-bottom: 10px;
}

.news-link {
  margin-top: auto;
  text-align: right;
  color: #0066cc;
  text-decoration: none;
  font-weight: bold;
}

#article-form {
  margin-top: 10px;
}

input[type="text"],
textarea {
  width: 100%;
  padding: 10px;
  margin-top: 5px;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-family: inherit;
  font-size: 14px;
  box-sizing: border-box;
  resize: none;
}

button {
  padding: 8px 14px;
  background-color: #0066cc;
  color: white;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
}

button:hover {
  background-color: #004a99;
}

.comment-box {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-top: 1px solid #ddd;
  padding: 8px 0;
  font-size: 14px;
}

.comment-box .comment-content {
  flex: 1;
  margin-right: 10px;
}

.comment-box button {
  background: #e74c3c;
  flex-shrink: 0;
}

.comment-box button:hover {
  background: #c0392b;
}

/* âœ… ê²Œì‹œê¸€ ì¹´ë“œ ì „ì²´ ìŠ¤íƒ€ì¼ */
.article-card {
  background: #fff;
  border: 1px solid #ccc;
  padding: 15px;
  margin: 15px 0;
  border-radius: 8px;
  overflow: hidden;
  box-sizing: border-box;
}

.article-meta {
  color: #666;
  font-size: 13px;
  margin-bottom: 8px;
}

.article-meta strong {
  color: #333;
}

@media (max-width: 1200px) {
  .main-grid {
    grid-template-columns: 1fr;
  }

  .news-container {
    grid-template-columns: 1fr;
  }

  .ad-section {
    justify-content: center;
  }
}

  </style>
</head>

<body>
<!-- âœ… ìƒë‹¨ ë¡œê·¸ì¸/íšŒì›ê°€ì… ë²„íŠ¼ -->
<div class="top-bar">
  <div class="top-bar-buttons" id="auth-buttons">
    <!-- ë¡œê·¸ì¸ ìƒíƒœì— ë”°ë¼ ì´ ë¶€ë¶„ì´ JSë¡œ ë°”ë€œ -->
    <button onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
    <button onclick="location.href='signup.html'">íšŒì›ê°€ì…</button>
  </div>
</div>

  <div class="main-grid">
    <!-- ë‰´ìŠ¤ ì˜ì—­ -->
    <div class="news-section">
      <h1>ìµœì‹  í•œêµ­ ë‰´ìŠ¤</h1>
      <div id="news-count" class="news-count"></div>
      <div id="news-container" class="news-container">
        <!-- JSì—ì„œ ì¹´ë“œ ì‚½ì… -->
      </div>
    </div>

    <!-- ê²Œì‹œíŒ ì˜ì—­ -->
    <div class="board-section">
      <h1>ğŸ“‹ ê²Œì‹œíŒ</h1>
      <div id="article-form">
        <input id="article-title" placeholder="ì œëª©" />
        <textarea id="article-content" placeholder="ë‚´ìš©"></textarea>
        <button onclick="createArticle()">ê²Œì‹œê¸€ ì‘ì„±</button>
      </div>
      <div id="articles-container"></div>
    </div>

    <!-- ê´‘ê³  ì˜ì—­ -->
    <div class="ad-section">
      <img src="banner.png" alt="ê´‘ê³  ì´ë¯¸ì§€" class="ad-image" />
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const token = localStorage.getItem('token');
      const topBar = document.querySelector('.top-bar-buttons');
  
      if (token) {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const userId = payload.title;
  
        topBar.innerHTML = `
          <span style="margin-right: 10px; font-weight: bold;">${userId}</span>
          <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
        `;
  
        document.getElementById('logout-btn').addEventListener('click', () => {
          localStorage.removeItem('token');
          alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
          window.location.reload();
        });
      } else {
        topBar.innerHTML = `
          <button onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
          <button onclick="location.href='signup.html'">íšŒì›ê°€ì…</button>
        `;
      }
  
      fetchNews();
      fetchArticles();
    });
  
    const BACKEND_URL = 'http://localhost:3000';
  
    async function fetchNews() {
      try {
        const response = await fetch(`${BACKEND_URL}/news`);
        const data = await response.json();
        if (data && data.data) {
          displayNews(data.data);
          updateNewsCount(data.data.length);
        }
      } catch (e) {
        console.error("ë‰´ìŠ¤ ë¡œë”© ì˜¤ë¥˜:", e);
      }
    }
  
    function displayNews(newsItems) {
      const container = document.getElementById('news-container');
      container.innerHTML = '';
      newsItems.forEach(news => {
        const card = document.createElement('div');
        card.className = 'news-card';
        card.innerHTML = `
          <div class="news-image-wrapper">
            <img class="news-image" src="${news.image_url || news.thumbnail_url}">
          </div>
          <div class="news-content">
            <h2 class="news-title">${news.title}</h2>
            <div class="news-date">${new Date(news.published_at).toLocaleDateString()} Â· ${news.publisher}</div>
            <a href="${news.content_url}" target="_blank" class="news-link">ê¸°ì‚¬ ì½ê¸° â†’</a>
          </div>
        `;
        container.appendChild(card);
      });
    }
  
    function updateNewsCount(count) {
      document.getElementById('news-count').textContent = `ì´ ë‰´ìŠ¤ ê°œìˆ˜: ${count}`;
    }
  
    async function fetchArticles() {
      const res = await fetch(`${BACKEND_URL}/articles`);
      const data = await res.json();
  
      const container = document.getElementById('articles-container');
      container.innerHTML = '';
  
      data.articles.forEach(article => {
        const div = document.createElement('div');
        div.className = 'article-card';
        div.innerHTML = `
          <h3>${article.title}</h3>
          <p>${article.content}</p>
          <p><strong>ì‘ì„±ì:</strong> ${article.username || ''}</p>
          <small>ì‘ì„±ì¼: ${new Date(article.created_at).toLocaleString()}</small><br />
          <button onclick="deleteArticle(${article.id})">ì‚­ì œ</button>
          <div style="margin-top:15px;">
            <textarea id="comment-${article.id}" placeholder="ëŒ“ê¸€ ì‘ì„±..."></textarea>
            <button onclick="addComment(${article.id})">ëŒ“ê¸€ ë“±ë¡</button>
            <div id="comments-${article.id}"></div>
          </div>
        `;
        container.appendChild(div);
        fetchComments(article.id);
      });
    }
  
    async function createArticle() {
      const title = document.getElementById('article-title').value;
      const content = document.getElementById('article-content').value;
      const token = localStorage.getItem('token');
  
      const res = await fetch(`${BACKEND_URL}/articles`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ title, content })
      });
  
      const result = await res.json();
      alert(result.message || result.error);
      fetchArticles();
    }
  
    async function deleteArticle(id) {
      const token = localStorage.getItem('token');
      if (!confirm("ì •ë§ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí• ê¹Œìš”?")) return;
  
      const res = await fetch(`${BACKEND_URL}/articles/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });
  
      const result = await res.json();
      alert(result.message || result.error);
      fetchArticles();
    }
  
    async function addComment(articleId) {
      const token = localStorage.getItem('token');
      const content = document.getElementById(`comment-${articleId}`).value;
  
      const res = await fetch(`${BACKEND_URL}/articles/${articleId}/comments`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token
        },
        body: JSON.stringify({ content })
      });
  
      const result = await res.json();
      alert(result.message || result.error);
      fetchComments(articleId);
    }
  
    async function fetchComments(articleId) {
      const res = await fetch(`${BACKEND_URL}/articles/${articleId}/comments`);
      const data = await res.json();
  
      const container = document.getElementById(`comments-${articleId}`);
      container.innerHTML = '<strong>ëŒ“ê¸€:</strong><br>';
  
      data.comments.forEach(comment => {
        container.innerHTML += `
          <div class="comment-box">
            <div class="comment-content">
              <strong>${comment.username}</strong>: ${comment.content}
            </div>
            <button onclick="deleteComment(${comment.id}, ${articleId})">ì‚­ì œ</button>
          </div>
        `;
      });
    }
  
    async function deleteComment(id, articleId) {
      const token = localStorage.getItem('token');
      const res = await fetch(`${BACKEND_URL}/comments/${id}`, {
        method: 'DELETE',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });
  
      const result = await res.json();
      alert(result.message || result.error);
      fetchComments(articleId);
    }
  </script>
    
</body>
</html>